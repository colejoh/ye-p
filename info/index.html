<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Ye-p Info Page</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script src='../script/Chart.js-master/Chart.js'></script>
	<script src='../script/moment.js'></script>
	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWY8hgOqA2BCs1yEDaxf2Q71w2BsQBPnY&libraries=places"></script>
	<link rel="stylesheet" href="../css/info-1.css">
</head>
<body>
	<div id="poop">
	</div>
	<script>
		$(document).ready(function() {
		$.getJSON("http://www.telize.com/geoip?callback=?",
			function(json) {
				sessionStorage.latitude = json.latitude;
		  	sessionStorage.longitude = json.longitude;
			}
		);
	});
	</script>
	<script>
		var latitude = Number(sessionStorage.latitude);
		var longitude = Number(sessionStorage.longtitude);
		var coordinates = {lat: latitude, lng: longitude};
		var service = new google.maps.places.PlacesService(document.getElementById('poop'));
		service.nearbySearch({
			location: coordinates,
			radius: 500
		}, callback);
		alert("test");
		function callback(place, status) {
			if (status == google.maps.places.PlacesServiceStatus.OK) {
			alert(place[0].place_id);
			sessionStorage.id = place[0].place_id;
			}
		}
	</script>
	<script>
		var myID = sessionStorage.id;
		var request = {
		  placeId: myID
		};
		var service = new google.maps.places.PlacesService(document.getElementById('poop'));
		service.getDetails(request, callback);
		function callback(place, status) {
			  if (status == google.maps.places.PlacesServiceStatus.OK) {
					$(".bus-rating").text(place.rating);
					$(".bus-name").text(place.name);
					$("#address").text(place.formatted_address);
					$("#phone").text(place.formatted_phone_number)
					$("#reviewnum").text(place.user_ratings_total);
					$("#monday").text(place.opening_hours.weekday_text[0]);
					$("#tuesday").text(place.opening_hours.weekday_text[1]);
					$("#wednesday").text(place.opening_hours.weekday_text[2]);
					$("#thursday").text(place.opening_hours.weekday_text[3]);
					$("#friday").text(place.opening_hours.weekday_text[4]);
					$("#saturday").text(place.opening_hours.weekday_text[5]);
					$("#sunday").text(place.opening_hours.weekday_text[6]);

					//ratings array
					var ratings = [];
					for (i = 0; i < 5; i++) {
						ratings[i] = place.reviews[i].rating;
					}

					//date array
					var dateOfReview = [];
					for (i = 0; i < 5; i++) {
						dateOfReview[i] = moment.unix(place.reviews[i].time).format("MM/DD/YYYY");
						dateOfReview.reverse();
					}

					var randomScalingFactor = function(){ return 9};
					var lineChartData = {
						labels : dateOfReview,
						datasets : [
							{
								label: "My First dataset",
								fillColor : "RGBA(49, 25, 58, .5)",
								strokeColor : "RGBA(49, 25, 58, 1)",
								pointColor : "RGBA(227, 39, 90, .5)",
								pointStrokeColor : "RGBA(227, 39, 90, 1)",
								pointHighlightFill : "RGBA(227, 39, 90, 1)",
								pointHighlightStroke : "RGBA(227, 39, 90, .5)",
								data : ratings
							}
						]
					}

					var ctx = document.getElementById("canvas").getContext("2d");
					window.myLine = new Chart(ctx).Line(lineChartData, {responsive: true});

			  }
			}

		</script>
	</div>

	<div class="navbar navbar-default">
		<div class="container-fluid">
			<div class="row">

				<div class="col-md-3 col-lg-3 cust">
						<div class="branding">ye-p.</div>
				</div>

				<div class="col-md-9 col-lg-9">
					<form class="navbar-form s-bar-total" role="search">
				          <input type="text" class="s-bar" placeholder="Search">
				          <input class="btn btn-default" type="submit" value="Search">
				    </form>
			    </div>

			</div>
		</div>
	</div>

	<div class="graph">
		<canvas id="canvas" height="50"></canvas>

		<script>

		</script>
	</div>

	<div class="bus-archetype">
		<div class="container">

			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
					<div class="row">
						<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<div class="bus-name"></div>
						</div>
						<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<div class="bus-rating"></div>
							<div class="reviews">Out of <div id="reviewnum"></div> reviews</div><!-- call number of reviews here -->
						</div>
					</div>
				</div>
			</div>
		</div>

			<hr class="break">


		<div class="container">
			<div class="row">

				<div class="col-md-6 col-lg-6">
						<div class="info ul">Info</div>
						<p class="placetext">
							<h5>Address: <div id="address" style="font-weight: 200;"></div></h5>
							<h5>Phone: <div id="phone" style="font-weight: 200;"></div></h5>
							<h5>Hours:
								<div id="monday" style="font-weight: 200"></div>
								<div id="tuesday" style="font-weight: 200"></div>
								<div id="wednesday" style="font-weight: 200"></div>
								<div id="thursday" style="font-weight: 200"></div>
								<div id="friday" style="font-weight: 200"></div>
								<div id="saturday" style="font-weight: 200"></div>
								<div id="sunday" style="font-weight: 200"></div>
							</h5>
						</p>
				</div>

				<div class="col-md-6 col-lg-6">
						<div class="data-a ul">Data Analysis</div>
						<p class="placetext">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Architecto sint, et porro. Tempora, dolorum pariatur soluta eius dolore nam autem cum corporis itaque hic dignissimos nobis iusto rem, enim consequatur tempore facere minima, quod debitis. Doloremque earum similique officiis, aspernatur perspiciatis? Facere nesciunt explicabo nihil magni, laboriosam debitis, molestiae iste. Aliquam natus eum architecto laborum quia ex officia neque, rerum est nobis culpa quae fugiat unde tempora quis omnis voluptatem! Ex illo fuga totam fugit rem ipsum dolor, enim ad omnis architecto culpa impedit in commodi vel, ipsam sunt, numquam odio sed cumque alias eaque obcaecati delectus? Aspernatur sed quis, et! Quas optio reiciendis dicta, quis voluptas, commodi perferendis eaque cupiditate, sit libero ab in repellendus laborum, nesciunt vero. Voluptas odio sapiente provident, fugiat molestias.</p>
				</div>

			</div>
		</div>


	</div>

</body>
</html>
