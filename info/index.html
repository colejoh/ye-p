<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Ye-p Info Page</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script src='../script/Chart.js-master/Chart.js'></script>
	<script src='../script/moment.js'></script>
	<link rel="stylesheet" href="../css/info-1.css">
</head>
<body>
	<div id="poop">
	</div>
		<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWY8hgOqA2BCs1yEDaxf2Q71w2BsQBPnY&libraries=places"></script>
		<script>
			var request = {
				//value recieved from results page gets put here
			  placeId: 'ChIJXSxg2vJ7j4ARSNJPCQe2F7Q'
			};
			service = new google.maps.places.PlacesService(document.getElementById('poop'));
			service.getDetails(request, callback);

			function callback(place, status) {
			  if (status == google.maps.places.PlacesServiceStatus.OK) {
					$(".bus-rating").text(place.rating);
					$(".bus-name").text(place.name);
					$("#address").text(place.formatted_address);
					$("#phone").text(place.formatted_phone_number)
					$("#reviewnum").text(place.user_ratings_total);
					$("#monday").text(place.opening_hours.weekday_text[0]);
					$("#tuesday").text(place.opening_hours.weekday_text[1]);
					$("#wednesday").text(place.opening_hours.weekday_text[2]);
					$("#thursday").text(place.opening_hours.weekday_text[3]);
					$("#friday").text(place.opening_hours.weekday_text[4]);
					$("#saturday").text(place.opening_hours.weekday_text[5]);
					$("#sunday").text(place.opening_hours.weekday_text[6]);

					//ratings array
					var ratings = [];
					for (i = 0; i < 5; i++) {
						ratings[i] = place.reviews[i].rating;
					}

					//average of last 5 ratings
					var avg = 0;
					for (i = 0; i < 5; i++) {
						avg += ratings[i];
					}
					avg = avg / 5;

					//date array
					var dateOfReview = [];
					for (i = 0; i < 5; i++) {
						dateOfReview[i] = moment.unix(place.reviews[i].time).format("MM/DD/YYYY");
						dateOfReview.reverse();
					}

					var millisecondsBetweenNowAnd5ReviewsAgo = (new Date().getTime()) - place.reviews[4].time;
					var months = millisecondsBetweenNowAnd5ReviewsAgo / 2628000000;
					console.log("Months: " + months);

					//comparing last 5 rating to entire rating
					var times = Math.round((avg / place.rating) * 100) / 100;
					console.log("New average is: " + times);

					if (times < 0.5) {
						$("#compare").text("Recently, " + place.name +
						" has been doing poorly. Their score has gone down by "
						+ (times * 100) + "%");
					} else if (times >= .5 && times < 1) {
						$("#compare").text("Recently, " + place.name +
						" has not been doing very well. Their score has gone down by "
						+ (times * 100) + "%");
					} else if (times >=1 && times < 1.5) {
						$("#compare").text("Recently, " + place.name +
						" has been doing better than average. Their score has gone up by "
						+ (times * 100) + "%");
					} else if (times >= 1.5 && times < 2) {
						$("#compare").text("Recently, " + place.name +
						" has been doing well. Their score has gone up by "
						+ (times * 100) + "%");
					} else {
						$("#compare").text("Recently, " + place.name +
						" has been doing very well. Their score has gone up by "
						+ (times * 100) + "%");
					}


					//Setting up paramaters of graph
					var randomScalingFactor = function(){ return 9};
					var lineChartData = {
						labels : dateOfReview,
						datasets : [
							{
								label: "My First dataset",
								fillColor : "RGBA(49, 25, 58, .5)",
								strokeColor : "RGBA(49, 25, 58, 1)",
								pointColor : "RGBA(227, 39, 90, .5)",
								pointStrokeColor : "RGBA(227, 39, 90, 1)",
								pointHighlightFill : "RGBA(227, 39, 90, 1)",
								pointHighlightStroke : "RGBA(227, 39, 90, .5)",
								data : ratings,
								maintainAspectRatio: false,
							}
						]
					}

					var ctx = document.getElementById("canvas").getContext("2d");
					window.myLine = new Chart(ctx).Line(lineChartData, {responsive: true});

			  }
			}

		</script>
	</div>

	<div class="navbar navbar-default">
		<div class="container-fluid">
			<div class="row">

				<div class="col-md-3 col-lg-3 cust">
						<div class="branding">ye-p.</div>
				</div>

				<div class="col-md-9 col-lg-9">
					<form class="navbar-form s-bar-total" role="search">
				          <input type="text" class="s-bar" placeholder="Search">
				          <input class="btn btn-default" type="submit" value="Search">
				    </form>
			    </div>

			</div>
		</div>
	</div>

	<div class="graph">
		<canvas id="canvas" height="50"></canvas>

		<script>

		</script>
	</div>

	<div class="bus-archetype">
		<div class="container">

			<div class="row">
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
					<div class="row">
						<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<div class="bus-name"></div>
						</div>
						<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
							<div class="bus-rating"></div>
							<div class="reviews">Out of <div id="reviewnum"></div> reviews</div><!-- call number of reviews here -->
						</div>
					</div>
				</div>
			</div>
		</div>

			<hr class="break">


		<div class="container">
			<div class="row">

				<div class="col-md-6 col-lg-6">
						<div class="info ul">Info</div>
						<p class="placetext">
							<h5>Address: <div id="address" style="font-weight: 200;"></div></h5>
							<h5>Phone: <div id="phone" style="font-weight: 200;"></div></h5>
							<h5>Hours:
								<div id="monday" style="font-weight: 200"></div>
								<div id="tuesday" style="font-weight: 200"></div>
								<div id="wednesday" style="font-weight: 200"></div>
								<div id="thursday" style="font-weight: 200"></div>
								<div id="friday" style="font-weight: 200"></div>
								<div id="saturday" style="font-weight: 200"></div>
								<div id="sunday" style="font-weight: 200"></div>
							</h5>
						</p>
				</div>

				<div class="col-md-6 col-lg-6">
						<div class="data-a ul">Data Analysis</div>
							<div id="compare"></div>
				</div>

			</div>
		</div>


	</div>

</body>
</html>
